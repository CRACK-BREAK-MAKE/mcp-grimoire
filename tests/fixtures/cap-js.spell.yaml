# CAP.js MCP Server Power Configuration
# MCP server for AI-assisted development of SAP Cloud Application Programming Model (CAP) applications
# Provides semantic search over CAP documentation and CDS model definitions

name: cap-js
version: 1.0.0
description: AI-powered assistant for SAP CAP development with CDS model search and documentation lookup
keywords:
  - cap
  - sap
  - cds
  - cloud application programming
  - core data services
  - sap btp
  - fiori
  - odata
  - entity
  - service
  - model
  - schema
  - database
  - nodejs
  - typescript
  - hana

server:
  transport: stdio
  command: npx
  args:
    - '-y'
    - '@cap-js/mcp-server'
  # Optional: Specify project path if not running from CAP project root
  # env:
  #   CDS_ROOT: /path/to/cap/project

steering: |
  # CAP.js MCP Server - Expert Guidance

  ## When to Use This Server

  Activate this server when the user:
  - Asks about SAP CAP, CDS models, or Fiori development
  - Needs to query entity definitions, services, or database schemas
  - Wants to search CAP documentation for best practices
  - Requests help with OData services, annotations, or relationships
  - Works with HANA, SAP BTP, or enterprise applications

  ## Available Tools

  ### 1. search_model
  **Purpose**: Search compiled CDS model definitions with fuzzy matching

  **Use this to find**:
  - Entity definitions and their fields
  - Service definitions and exposed entities
  - HTTP endpoints (e.g., GET /Books)
  - Annotations (e.g., @readonly, @cds.persistence.skip)
  - Relationships between entities
  - Type definitions and enums

  **Best Practices**:
  - Start with broad searches (e.g., "Book") then narrow down
  - Use `kind` parameter to filter by type: entity, service, type, action, function
  - Set `topN` to get multiple results for comparison
  - Use `namesOnly: true` for quick overview before detailed lookup

  **Example Queries**:
  - Find book entity: `name: "Book", kind: "entity"`
  - Find all services: `kind: "service", topN: 10, namesOnly: true`
  - Find specific endpoint: `name: "/Books", topN: 5`

  ### 2. search_docs
  **Purpose**: Semantic search through CAP documentation using vector embeddings

  **Use this to learn**:
  - How to implement features (e.g., "add columns to SELECT")
  - Best practices for CAP development
  - API usage and syntax
  - Architecture patterns and design guidance

  **Best Practices**:
  - Use natural language questions (no need for exact keywords)
  - Be specific about technology (Node.js vs Java)
  - Search BEFORE proposing changes to verify approach
  - Request more results (maxResults: 5-10) for complex topics

  **Example Queries**:
  - "how to add columns to a select statement in CAP Node.js"
  - "define one-to-many relationships in CDS"
  - "implement draft-enabled entities"
  - "add custom logic to OData services"

  ## Workflow for CAP Development

  1. **Discovery Phase**
     - Use `search_model` with `namesOnly: true` to list available entities/services
     - Get overview of project structure

  2. **Detail Investigation**
     - Use `search_model` with specific names to get full definitions
     - Check annotations, relationships, and types

  3. **Implementation Guidance**
     - Use `search_docs` to find official CAP patterns
     - Search for examples and best practices

  4. **Verification**
     - After code changes, use `search_model` again to verify structure
     - Use `search_docs` to confirm approach aligns with CAP conventions

  ## Important Rules

  ⚠️ **ALWAYS search with this server BEFORE**:
  - Reading .cds files manually
  - Proposing changes to CDS models
  - Writing custom handlers or extensions
  - Adding annotations or configurations

  ✅ **DO**:
  - Trust the compiled model over source files (CDS compilation may transform code)
  - Use semantic search for learning ("how do I...")
  - Use fuzzy search for discovery (partial names work)
  - Check multiple results if first match isn't perfect

  ❌ **DON'T**:
  - Skip searches and read files directly
  - Propose changes without checking documentation first
  - Assume syntax from other frameworks works in CAP
  - Ignore annotations (they're critical in CAP)

  ## Performance Tips

  - `search_model` is very fast - use it liberally
  - `search_docs` uses AI embeddings - may take 1-2 seconds
  - Set appropriate `topN` and `maxResults` to avoid overwhelming responses
  - Use `namesOnly` for quick scans before detailed lookups

  ## Project Context

  This server requires a CAP project context to function. Ensure you're running from:
  - CAP project root (where package.json and srv/ folders exist)
  - Or set CDS_ROOT environment variable to project path

  The server works with both Node.js and Java CAP projects.
